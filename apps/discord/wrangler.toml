# --- Defaults --- #

name = "frugal-core-dev"
main = "dist/index.mjs"
compatibility_date = "2023-04-09"
workers_dev = true
# no_bundle = true

[build]
command = "NODE_ENV=development npx turbo build"
watch_dir = "src"

[[rules]]
type = "ESModule"
globs = ["**/*.ts", "**/*.tsx"]

# --- Staging --- #

[env.staging]
name = "frugal-core-stg"

[env.staging.vars]
ENVIRONMENT = "staging"

[[env.staging.durable_objects.bindings]]
name = "GIVEAWAY_STATE"
class_name = "GiveawayStateV2"

[[env.staging.migrations]]
tag = "v1"
new_classes = ["GiveawayState"]
[[env.staging.migrations]]
tag = "v2"
new_classes = ["GiveawayStateV2"]
deleted_classes = ["GiveawayState"]

[[env.staging.r2_buckets]]
binding = "STORAGE"
bucket_name = "frugal-staging"

[[env.staging.analytics_engine_datasets]]
binding = "ANALYTICS"

[env.staging.build]
command = "NODE_ENV=production npx turbo build"

[[env.staging.d1_databases]]
binding = "D1"
database_name = "frugal"
database_id = "b3f0981c-e213-4b28-be7f-1ba9ad731024"
migrations_dir = "../../packages/d1-database/migrations"

# --- Production --- #

[env.production]
name = "frugal-core-prd"

[env.production.vars]
ENVIRONMENT = "production"

[[env.production.durable_objects.bindings]]
name = "GIVEAWAY_STATE"
class_name = "GiveawayStateV2"

[[env.production.migrations]]
tag = "v1"
new_classes = ["GiveawayState"]
[[env.production.migrations]]
tag = "v2"
new_classes = ["GiveawayStateV2"]
deleted_classes = ["GiveawayState"]

[[env.production.r2_buckets]]
binding = "STORAGE"
bucket_name = "frugal-prod"

[[env.production.analytics_engine_datasets]]
binding = "ANALYTICS"

[env.production.build]
command = "NODE_ENV=production npx turbo build"
watch_dir = "src"

[[env.production.d1_databases]]
binding = "D1"
database_name = "frugal"
database_id = "a09d43b8-850e-4f4d-ba91-fe47d3be0ec9"
migrations_dir = "../../packages/d1-database/migrations"

# --- Development, or unspecified --- #

[vars]
ENVIRONMENT = "development"

[[durable_objects.bindings]]
name = "GIVEAWAY_STATE"
class_name = "GiveawayStateV2"

[[migrations]]
tag = "v1"
new_classes = ["GiveawayState"]
[[migrations]]
tag = "v2"
new_classes = ["GiveawayStateV2"]
deleted_classes = ["GiveawayState"]

[[r2_buckets]]
binding = "STORAGE"
bucket_name = "frugal-devel"
preview_bucket_name = "frugal-devel"

[[analytics_engine_datasets]]
binding = "ANALYTICS"

[[d1_databases]]
binding = "D1"
database_name = "frugal"
database_id = "ddc7d747-ada2-4e1c-9946-62856277f9a1"
preview_database_id = "ddc7d747-ada2-4e1c-9946-62856277f9a1"
migrations_dir = "../../packages/d1-database/migrations"
